<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.hashtag.db">
  
  <insert id="create" parameterType="com.ssafy.hashtag.db.dto.ChatDto">
    INSERT INTO chat(opener_id, sex, nickname, title, description, location)
    VALUES(#{opener_id},
            #{sex},
            #{nickname},
            #{title},
            #{description},
            #{location})
  </insert>

  <delete id="delete" parameterType="com.ssafy.hashtag.db.dto.ChatDto">
    DELETE FROM chat WHERE chat_pk=#{chat_pk} AND opener_id=#{opener_id}
  </delete>

  <select id="locate" parameterType="java.lang.String" resultType="com.ssafy.hashtag.db.dto.ChatDto">
    SELECT * FROM chat WHERE location=#{location}
  </select>

  <insert id="enter" parameterType="com.ssafy.hashtag.db.dto.ChatroomDto">
    INSERT INTO chatroom(chat_id, user_id, nickname)
    VALUES(#{chat_id},
            #{user_id},
            #{nickname})
  </insert>
  
  <delete id="leave" parameterType="com.ssafy.hashtag.db.dto.ChatroomDto">
    DELETE FROM chatroom WHERE chat_id=#{chat_id} AND user_id=#{user_id}
  </delete>

  <select id="check_chat" parameterType="java.lang.Integer" resultType="java.lang.String">
    SELECT sex FROM chat WHERE chat_pk=#{chat_pk}
  </select>

  <select id="check_user" parameterType="java.lang.Integer" resultType="java.lang.String">
    SELECT sex FROM user WHERE user_pk=#{user_pk}
  </select>

  <select id="chat_user" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    SELECT user_id FROM chatroom WHERE chat_id=#{chat_pk}
  </select>

</mapper>
